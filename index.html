<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Yuna AI - a virtual girlfriend">
    <meta name="keywords" content="Yuki Arimo, Yuna, Yuna AI, GPT">
    <meta name="author" content="Yuki Arimo">
    <meta name="robots" content="index, follow">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar" content="#99c189">
    <meta name="theme-color" content="#99c189" />
    <link rel="icon" href="static/img/favicon.ico" type="image/x-icon">
    <meta name="referrer" content="no-referrer-when-downgrade"> <!-- For privacy and security -->

    <title>Yuna</title>

    <link rel="stylesheet" href="static/css/kawai-v11-2.css">
    <link rel="stylesheet" href="static/css/index.css">
    <script src="static/js/kawai-v11-2.js" defer></script>
    <link href="/manifest.json" rel="manifest" crossorigin="use-credentials" />
    <script src="static/js/index.js" defer></script>
    <script src="static/js/himitsu.js" defer></script>
    <script src="static/js/setup.js" defer></script>
    <script src="static/js/auth.js" defer></script>

    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js').then(
                    function (registration) {
                        // Registration was successful
                        console.log('ServiceWorker registration successful with scope: ', registration
                            .scope);
                    },
                    function (err) {
                        // registration failed :(
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</head>

<body onload="checkLoginStatus()">

    <div id="login-form" style="display:none;">
        <form onsubmit="handleLogin(event)">
            <h2>Login</h2>
            <label for="login-username">Username:</label>
            <input type="text" id="login-username" name="username" required>
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" name="password" required>
            <input type="submit" value="Login">
        </form>
    </div>

    <div id="register-form" style="display:none;">
        <form onsubmit="handleRegister(event)">
            <h2>Register</h2>
            <label for="register-username">Username:</label>
            <input type="text" id="register-username" name="username" required>
            <label for="register-password">Password:</label>
            <input type="password" id="register-password" name="password" required>
            <input type="submit" value="Register">
        </form>
    </div>


    <div id="main">

    <div class="sidebar-o desktop-only" id="sidebar">

        <div class="side-tab-block">
            <div class="side-tab-block-e" style="align-self: center; flex-direction: column;" onclick="toggleSidebar()">
                <img src="static/img/yuna.png" alt="Yuna logo">
            </div>

            <div class="side-tab-block-e">
                <div style="display: flex; flex-direction: row;">
                    <img class="block-icon" src="static/img/icons/edit.png" onclick="openChatManager()" alt="">
                    <div class="block-text lb">Chats</div>
                    <img class="block-icon" src="static/img/icons/flask.png" onclick="OpenPopup('options')" alt="">
                </div>
                
                <select class="block-select" id="history-select" onchange="loadSelectedHistory()">üìÅ</select>
            </div>
            <div class="side-tab-block-e" onclick="openConfigParams()">
                <div class="block-text lb">Params</div>
                <div class="block-scroll" id="parameter-container">
                </div>
                <img class="block-icon" src="static/img/icons/delete.png" onclick="localStorage.clear()" alt="Delete">
                <img class="block-icon" src="static/img/icons/cancel.png" alt="Cancel">
                <img class="block-icon" src="static/img/icons/done.png" onclick="saveConfigParams()" alt="Save">
            </div>

            <div class="side-tab-block-e">
                <div class="block-text lb">Prompts</div>
                <label for="templateSelect">Select Template:</label>
                <select class="block-select block-list" id="templateSelect" size="3" onchange="changeTemplate()">
                    <option value="default">Default</option>
                    <option value="writer">Writer</option>
                    <option value="paraphrase">Paraphrase</option>
                    <option value="decisionMaking">Decision</option>
                    <option value="himitsu">himitsu</option>
                </select>

                <div id="generatedText"></div>

            </div>
        </div>
    </div>

    <div class="topbar-o">
        <div class="block-button" onclick="toggleSidebar()"><img class="block-icon" src="static/img/icons/hamburger.png"
                alt="Menu"></div>
        <div class="la block-text">Yuna</div>
        <div class="top-tab-block">
            <div class="block-button" id="callButton" onclick="OpenPopup('call');"><img class="block-icon"
                    src="static/img/icons/call.png" alt="Call"></div>
        </div>
    </div>

    <div class="block-o">
        <div class="tab-o tab-o-default" id="1">
            <div class="coll-lo">
                <div class="block-card block-scroll" id="message-container">
                    <!-- Dynamic HTML elements will be added here -->
                </div>
            </div>

            <div class="coll-lo">
                <div class="input-wrapper">
                    <form class="block-card el-9 h-coll" onsubmit="handleSubmit(event)" id="send-msg">
                        <textarea id="input_text" placeholder="Talk to Yuna..."></textarea>
                        <div id="msg-btn">
                            <button type="submit" class="block-button"><img class="block-icon"
                                    src="static/img/icons/send.png" alt="Send"></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="block-popup" id="options">
        <div class="modal-content">
            <div class="modal-header">Settings</div>

            <div class="modal-body">
                <div class="block-list block-card el-9">
                    <div class="block-list-e" onclick="checkConfigData()">‚öôÔ∏è Auto Fix</div>
                    <div class="block-list-e" onclick="fixDialogData()">‚öôÔ∏è Auto Build</div>
                    <div class="block-list-e" onclick="toggleTheme()">‚öôÔ∏è Toggle Mode</div>
                    <div class="block-list-e" onclick="openConfigParams()">‚öôÔ∏è Settings</div>
                </div>

                <div class="modal-footer">
                    <div class="block-button" onclick="closePopupsAll();">Close</div>
                </div>
            </div>
        </div>
    </div>

    <div class="block-popup" id="call">
        <audio id="backgroundMusic">
            <source src="static/audio/output.mp3" type="audio/mp3">
        </audio>

        <canvas id="capture-canvas" style="display: none;"></canvas>

        <div class="video-call-container">
            <div class="participant participant-1"><img src="static/img/yuna-full.png" alt="Yuna Participant"></div>
            <div class="participant participant-2"><video id="localVideo" playsinline autoplay muted
                    class="draggable-video"></video></div>
        </div>

        <div class="controls">
            <div class="control">
                <img src="static/img/icons/camera.png" id="capture-image" onclick="captureImage()" alt="Camera">
            </div>
            <div class="control">
                <img src="static/img/icons/microphone.png" onclick="muteAudio();" alt="Microphone">
            </div>
            <div class="control">
                <img src="static/img/icons/art.png" id="draw-art" onclick="drawArt()" alt="Other Control">
            </div>
            <div class="control">
                <img src="static/img/icons/end.png" alt="Hang Up" onclick="closePopupsAll();">
            </div>

            <!--
            <div class="controls">
                <button class="block-button" id="startBtn">Rec</button>
                <button class="block-button" id="pauseBtn" disabled>Pause</button>
                <button class="block-button" id="stopBtn" disabled>Stop</button>
                <button class="block-button" id="sendBtn" disabled>Send</button>
            </div>

            <div id="duration">Duration: 0:00</div>
            <audio id="audioPlayer" controls></audio>
            -->
        </div>
    </div>

        <div class="block-popup" id="chat">
            <div class="modal-content">
                <div class="modal-header">Chat manager</div>
                <div class="modal-body">
                    <div class="coll-lo">
                        <div class="block-card el-9">
                            <div class="block-card la" id="current-history" style="color: black !important;">History
                            </div>

                            <div style="display: flex; flex-direction: row;">
                                <img class="block-icon" src="static/img/icons/edit.png" onclick="editHistory()" alt="">
                                <img class="block-icon" src="static/img/icons/flask.png" onclick="loadSelectedHistory()" alt="">
                                <img class="block-icon" src="static/img/icons/download.png" onclick="downloadHistory()" alt="">
                            </div>
                        </div>
                    </div>

                    <div class="coll-lo">
                        <form class="el-9 block-card" id="mng-hist-form" onsubmit="processForm(event)">
                            <label for="historyName">History Name:</label>
                            <input class="block-input" type="text" id="historyName" name="historyName"
                                placeholder="Enter file name">
                            <label for="historyNewName">New Name:</label>
                            <input class="block-input" type="text" id="historyNewName" name="historyNewName"
                                placeholder="New name, only for rename">
                            <label for="historyOptions">Options:</label>
                            <select class="block-select" id="historyOptions" name="historyOptions">
                                <option value="create">Create</option>
                                <option value="rename">Rename</option>
                                <option value="delete">Delete</option>
                            </select>
                            <input type="submit" value="Submit">
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="block-button" onclick="closePopupsAll();">Close</div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>